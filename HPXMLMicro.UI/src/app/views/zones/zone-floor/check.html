<div
  formGroupName="insulation"
  class="border rounded-2 row mx-0 px-1 pt-3 pb-1 mb-2"
>
  <div class="col-md-6">
    <div class="input-box">
      <label>Assembly Effective R-Value </label>
      <input
        formControlName="assemblyEffectiveRValue"
        type="number"
        id="assemblyEffectiveRValue"
        placeholder="Assembly Effective R-Value"
      />
      <div
        class="errormsg"
        *ngIf="
        (roofInsulationObj(atticIndex, roofIndex).get(
          'assemblyEffectiveRValue'
        )?.touched ||
          roofInsulationObj(atticIndex, roofIndex).get(
            'assemblyEffectiveRValue'
          )?.dirty) &&
        roofInsulationObj(atticIndex, roofIndex).get(
          'assemblyEffectiveRValue'
        )?.invalid
      "
      >
        <label class="text-danger fw-semibold position-absolute">
          Assembly Effective R-Value is invalid
        </label>
      </div>
    </div>
  </div>
  <ng-container formArrayName="layers">
    <div class="col-12 d-flex my-3">
      <h5 class="mb-0">Layers</h5>
      <button
        class="ms-2 icon-btn"
        (click)="
        addToFormArray(
          roofInsulationLayersObj(
            atticIndex,
            roofIndex
          ),
          layerInputs()
        )
      "
      >
        <img src="/assets/icons/plus.svg" width="20px" alt="" />
      </button>
    </div>
    <div
      *ngFor="
      let roofInsulationLayerItem of roofInsulationLayersObj(
        atticIndex,
        roofIndex
      )?.controls;
      let roofInsulationLayerIndex = index
    "
      class="border rounded-2 row mx-0 px-0 pt-3 pb-1 mb-2"
    >
      <div class="col-12 d-flex">
        <h5 class="mb-0">Layer ({{ roofInsulationLayerIndex + 1 }})</h5>
        <button
          class="ms-2 icon-btn"
          (click)="
          removeFromFormArray(
            roofInsulationLayersObj(
              atticIndex,
              roofIndex
            ),
            roofInsulationLayerIndex
          )
        "
        >
          <img src="/assets/icons/delete.svg" alt="" />
        </button>
      </div>
      <ng-container [formGroupName]="roofInsulationLayerIndex">
        <div class="col-md-6">
          <div class="input-box">
            <label> Nominal R-Value </label>
            <input
              formControlName="nominalRValue"
              type="number"
              id="nominalRValue"
              placeholder="Nominal R-Value"
            />
            <div
              class="errormsg"
              *ngIf="
              (roofInsulationLayerItem.get('nominalRValue')
                ?.touched ||
                roofInsulationLayerItem.get('nominalRValue')
                  ?.dirty) &&
              roofInsulationLayerItem.get('nominalRValue')
                ?.invalid
            "
            >
              <label class="text-danger fw-semibold position-absolute">
                Nominal R-Value is invalid
              </label>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="select-box">
            <label> Installation Type </label>
            <ng-select
              [items]="installationTypeOptions"
              bindLabel="name"
              [clearable]="true"
              [closeOnSelect]="true"
              bindValue="value"
              placeholder="Installation Type"
              id="installationType"
              formControlName="installationType"
            >
            </ng-select>
            <div
              class="errormsg"
              *ngIf="
              (roofInsulationLayerItem.get(
                'installationType'
              )?.touched ||
                roofInsulationLayerItem.get(
                  'installationType'
                )?.dirty) &&
              roofInsulationLayerItem.get(
                'installationType'
              )?.invalid
            "
            >
              <label class="text-danger fw-semibold position-absolute">
                Installation Type is invalid
              </label>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="select-box">
            <label> Insulation Material </label>
            <ng-select
              [items]="insulationMaterialOptions"
              bindLabel="name"
              [clearable]="true"
              [closeOnSelect]="true"
              bindValue="value"
              placeholder="Insulation Material"
              id="insulationMaterial"
              formControlName="insulationMaterial"
            >
            </ng-select>
            <div
              class="errormsg"
              *ngIf="
              (roofInsulationLayerItem.get(
                'insulationMaterial'
              )?.touched ||
                roofInsulationLayerItem.get(
                  'insulationMaterial'
                )?.dirty) &&
              roofInsulationLayerItem.get(
                'insulationMaterial'
              )?.invalid
            "
            >
              <label class="text-danger fw-semibold position-absolute">
                Insulation Material is invalid
              </label>
            </div>
          </div>
        </div>
        <ng-container formArrayName="insulationMaterialDynamicOptions">
          <ng-container
            *ngFor="
            let insulationMaterialDynamic of roofInsulationMaterialDynamicOptionsObj(
              atticIndex,
              roofIndex,
              roofInsulationLayerIndex
            )?.controls;
            let insulationMaterialDynamicIndex = index
          "
          >
            <ng-container [formGroupName]="insulationMaterialDynamicIndex">
              <div class="col-md-6">
                <div class="select-box">
                  <label>
                    {{ insulationMaterialDynamic.get("options") ?.value?.label
                    }}
                  </label>
                  <ng-select
                    [items]="
                    insulationMaterialDynamic.get('options')
                      ?.value?.options
                  "
                    bindLabel="name"
                    [clearable]="true"
                    [closeOnSelect]="true"
                    bindValue="value"
                    [placeholder]="
                    insulationMaterialDynamic.get('options')
                      ?.value?.placeHolder
                  "
                    id="radiantBarrier"
                    [formControlName]="
                    insulationMaterialDynamic.get('options')
                      ?.value?.name
                  "
                  >
                  </ng-select>
                  <div
                    class="errormsg"
                    *ngIf="
                    (insulationMaterialDynamic.get(
                      insulationMaterialDynamic.get(
                        'options'
                      )?.value?.name
                    )?.touched ||
                      insulationMaterialDynamic.get(
                        insulationMaterialDynamic.get(
                          'options'
                        )?.value?.name
                      )?.dirty) &&
                    insulationMaterialDynamic.get(
                      insulationMaterialDynamic.get(
                        'options'
                      )?.value?.name
                    )?.invalid
                  "
                  >
                    <label class="text-danger fw-semibold position-absolute">
                      {{ insulationMaterialDynamic.get( "options"
                      )?.value?.errorMsg }}
                    </label>
                  </div>
                </div>
              </div>
            </ng-container>
          </ng-container>
        </ng-container>
      </ng-container>
    </div>
  </ng-container>
</div>
